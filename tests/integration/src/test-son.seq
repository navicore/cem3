# Tests for son.seq - SON (Seq Object Notation) stdlib module

include std:son

# Test that std:son re-exports map-of and kv
: test-son-map-builder ( -- )
  map-of "key" "value" kv
  dup map.size 1 test.assert-eq
  "key" map.get test.assert "value" string.equal? test.assert
;

# Test that std:son re-exports list-of and lv
: test-son-list-builder ( -- )
  list-of 1 lv 2 lv 3 lv
  list.length 3 test.assert-eq
;

# Test nested SON structure (real-world use case)
: test-son-nested-structure ( -- )
  # Build inner lists first
  map-of "name" "Alice" kv "age" 30 kv
  map-of "name" "Bob" kv "age" 25 kv
  # Build users list
  list-of rot lv swap lv
  # Build outer map
  map-of swap "users" swap kv "count" 2 kv

  dup map.size 2 test.assert-eq
  "count" map.get test.assert 2 test.assert-eq
;

# Test empty structures via son
: test-son-empty-structures ( -- )
  map-of map.empty? test.assert
  list-of list.empty? test.assert
;

# Test combined map and list in single expression
: test-son-combined ( -- )
  # Config-like structure: { "ports": [80, 443, 8080] }
  list-of 80 lv 443 lv 8080 lv
  map-of swap "ports" swap kv

  "ports" map.get test.assert
  list.length 3 test.assert-eq
;
