# Test map operations

: print-result ( Int String -- )
  swap if
    " PASS" string-concat write_line
  else
    " FAIL" string-concat write_line
  then
;

# Test make-map and map-set
: test-make-set ( -- )
  make-map
  "name" "Alice" map-set
  "age" 30 map-set
  map-size 2 =
  "make-map and map-set: size is 2" print-result
;

# Test map-get
: test-map-get ( -- )
  make-map
  "key" "value" map-set
  "key" map-get "value" string-equal
  "map-get: retrieves correct value" print-result
;

# Test map-get-safe found
: test-map-get-safe-found ( -- )
  make-map "x" 42 map-set
  "x" map-get-safe
  "map-get-safe: returns 1 when found" print-result
  42 =
  "map-get-safe: returns correct value" print-result
;

# Test map-get-safe not found
: test-map-get-safe-not-found ( -- )
  make-map
  "missing" map-get-safe
  not "map-get-safe: returns 0 when not found" print-result
  drop  # drop placeholder value
;

# Test map-has?
: test-map-has ( -- )
  make-map "a" 1 map-set
  dup "a" map-has?
  "map-has?: returns 1 for existing key" print-result
  "b" map-has? not
  "map-has?: returns 0 for missing key" print-result
;

# Test map-remove
: test-map-remove ( -- )
  make-map "x" 1 map-set "y" 2 map-set
  "x" map-remove
  dup "x" map-has? not
  "map-remove: key is gone" print-result
  "y" map-has?
  "map-remove: other key remains" print-result
;

# Test map-keys and map-values
: test-keys-values ( -- )
  make-map "a" 1 map-set "b" 2 map-set
  dup map-keys list-length 2 =
  "map-keys: returns 2 keys" print-result
  map-values list-length 2 =
  "map-values: returns 2 values" print-result
;

# Test map-size
: test-map-size ( -- )
  make-map map-size 0 =
  "map-size: empty map has size 0" print-result
  make-map "a" 1 map-set "b" 2 map-set "c" 3 map-set
  map-size 3 =
  "map-size: returns correct count" print-result
;

# Test map-empty?
: test-map-empty ( -- )
  make-map map-empty?
  "map-empty?: returns 1 for empty map" print-result
  make-map "k" "v" map-set map-empty? not
  "map-empty?: returns 0 for non-empty map" print-result
;

# Test with integer keys
: test-int-keys ( -- )
  make-map
  1 "one" map-set
  2 "two" map-set
  3 "three" map-set
  2 map-get "two" string-equal
  "integer keys: works correctly" print-result
;

: main ( -- Int )
  "Testing make-map and map-set:" write_line
  test-make-set

  "Testing map-get:" write_line
  test-map-get

  "Testing map-get-safe (found):" write_line
  test-map-get-safe-found

  "Testing map-get-safe (not found):" write_line
  test-map-get-safe-not-found

  "Testing map-has?:" write_line
  test-map-has

  "Testing map-remove:" write_line
  test-map-remove

  "Testing map-keys and map-values:" write_line
  test-keys-values

  "Testing map-size:" write_line
  test-map-size

  "Testing map-empty?:" write_line
  test-map-empty

  "Testing integer keys:" write_line
  test-int-keys

  0
;
