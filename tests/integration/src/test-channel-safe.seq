# Test chan.send-safe and chan.receive-safe error handling

# Test chan.send-safe with valid channel
: test-chan.send-safe-success ( -- )
  chan.make  # create channel, get ID
  42 swap chan.send-safe
  test.assert
;

# Test chan.send-safe with invalid channel ID
: test-chan.send-safe-invalid ( -- )
  42 999999 chan.send-safe  # non-existent channel
  test.assert-not  # should return 0 (failure)
;

# Test chan.receive-safe with valid channel
: test-chan.receive-safe-success ( -- )
  chan.make  # create channel, get ID
  dup 42 swap chan.send # send value
  chan.receive-safe  # returns (value success_flag)
  test.assert  # success flag should be true
  42 test.assert-eq  # value should be 42
;

# Test chan.receive-safe with invalid channel ID
: test-chan.receive-safe-invalid ( -- )
  999999 chan.receive-safe  # non-existent channel
  test.assert-not  # should return 0 (failure)
  drop  # drop the placeholder value
;
