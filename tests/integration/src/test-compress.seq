# Test compression operations

# compress.gzip / compress.gunzip - Basic gzip roundtrip
: test-gzip-roundtrip ( -- )
  "hello world" compress.gzip compress.gunzip
  test.assert   # success flag
  "hello world" test.assert-eq-str
;

# compress.gzip-level - Compression with level
: test-gzip-level ( -- )
  "hello world" 9 compress.gzip-level compress.gunzip
  test.assert   # success flag
  "hello world" test.assert-eq-str
;

# compress.zstd / compress.unzstd - Basic zstd roundtrip
: test-zstd-roundtrip ( -- )
  "hello world" compress.zstd compress.unzstd
  test.assert   # success flag
  "hello world" test.assert-eq-str
;

# compress.zstd-level - Compression with level
: test-zstd-level ( -- )
  "hello world" 19 compress.zstd-level compress.unzstd
  test.assert   # success flag
  "hello world" test.assert-eq-str
;

# Test empty string compression
: test-empty-string-gzip ( -- )
  "" compress.gzip compress.gunzip
  test.assert   # success flag
  "" test.assert-eq-str
;

: test-empty-string-zstd ( -- )
  "" compress.zstd compress.unzstd
  test.assert   # success flag
  "" test.assert-eq-str
;

# Test invalid base64 input
: test-invalid-base64-gunzip ( -- )
  "not valid base64!!!" compress.gunzip
  test.assert-not  # should fail
  drop  # drop empty string
;

: test-invalid-base64-unzstd ( -- )
  "not valid base64!!!" compress.unzstd
  test.assert-not  # should fail
  drop  # drop empty string
;

# Test valid base64 but invalid compressed data
: test-invalid-gzip-data ( -- )
  "aGVsbG8gd29ybGQ=" compress.gunzip  # base64("hello world")
  test.assert-not  # should fail - not gzip
  drop
;

: test-invalid-zstd-data ( -- )
  "aGVsbG8gd29ybGQ=" compress.unzstd  # base64("hello world")
  test.assert-not  # should fail - not zstd
  drop
;

# Test larger data
: test-large-data-gzip ( -- )
  "This is a longer string that should compress well when repeated. "
  dup string.concat dup string.concat dup string.concat  # repeat 8 times
  dup compress.gzip compress.gunzip
  test.assert   # success flag
  test.assert-eq-str  # original == decompressed
;

: test-large-data-zstd ( -- )
  "This is a longer string that should compress well when repeated. "
  dup string.concat dup string.concat dup string.concat  # repeat 8 times
  dup compress.zstd compress.unzstd
  test.assert   # success flag
  test.assert-eq-str  # original == decompressed
;

# Test that different compression levels work
: test-gzip-levels ( -- )
  "test data for compression levels"
  dup 1 compress.gzip-level compress.gunzip test.assert test.assert-eq-str
  "test data for compression levels"
  dup 5 compress.gzip-level compress.gunzip test.assert test.assert-eq-str
  "test data for compression levels"
  dup 9 compress.gzip-level compress.gunzip test.assert test.assert-eq-str
;

: test-zstd-levels ( -- )
  "test data for compression levels"
  dup 1 compress.zstd-level compress.unzstd test.assert test.assert-eq-str
  "test data for compression levels"
  dup 10 compress.zstd-level compress.unzstd test.assert test.assert-eq-str
  "test data for compression levels"
  dup 22 compress.zstd-level compress.unzstd test.assert test.assert-eq-str
;

# Test special characters
: test-special-chars-gzip ( -- )
  "Hello\nWorld\tTab\"Quote\\Backslash"
  dup compress.gzip compress.gunzip
  test.assert
  test.assert-eq-str
;

: test-special-chars-zstd ( -- )
  "Hello\nWorld\tTab\"Quote\\Backslash"
  dup compress.zstd compress.unzstd
  test.assert
  test.assert-eq-str
;
