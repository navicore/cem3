# Test list operations: map, filter, fold, each

# Create a test list using string.split (produces Variant of strings)
: make-string-list ( -- Variant )
  "apple banana cherry" " " string.split
;

# Test list.map: uppercase each string
: test-list.map ( -- )
  make-string-list [ string.to-upper ] list.map
  # Result should be ["APPLE", "BANANA", "CHERRY"]
  dup 0 variant.field-at "APPLE" string.equal? test.assert
  2 variant.field-at "CHERRY" string.equal? test.assert
;

# Test list.filter: keep strings longer than 5 chars
: test-list.filter ( -- )
  make-string-list [ string.length 5 > ] list.filter
  # Result should be ["banana", "cherry"] (both > 5 chars)
  dup list.length 2 test.assert-eq
  0 variant.field-at "banana" string.equal? test.assert
;

# Test list.fold: concatenate all strings
: test-list.fold ( -- )
  make-string-list "" [ string.concat ] list.fold
  # Result should be "applebananacherry"
  "applebananacherry" string.equal? test.assert
;

# Test list.length
: test-list.length ( -- )
  make-string-list list.length 3 test.assert-eq
;

# Test list.empty?
: test-list-empty ( -- )
  make-string-list list.empty? test.assert-not
;

# Test list.each: verify iteration completes
: test-list.each ( -- )
  # list.each expects ( Variant Quotation -- )
  # The quotation receives each element for side effects
  # We just verify it runs without error by checking list length matches iteration count
  make-string-list dup list.length
  swap [ drop ] list.each
  3 test.assert-eq
;
