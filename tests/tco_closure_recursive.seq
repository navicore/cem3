# Closure Recursive TCO Test (Phase 3)
#
# This test verifies that closures can handle deep recursion.
# The key is that with Arc-based environments, patch_seq_call
# doesn't need post-call cleanup, allowing tail position behavior.
#
# Note: True musttail TCO for closures would require matching
# calling conventions. This test verifies the Arc changes work.

: recurse-with-closure ( Int -- Int )
    # Each call creates a new closure that captures n
    # and recurses via a fresh closure
    dup 0 > if
        1 subtract
        dup [ drop recurse-with-closure ] call
    then
;

: main ( -- )
    "Testing closure with captured value (50000 recursions)..." write_line
    50000 recurse-with-closure drop
    "Success! Closure recursion completed." write_line
;
