# Test send-safe and receive-safe error handling

: print-result ( Int String -- )
  swap if
    " PASS" string-concat write_line
  else
    " FAIL" string-concat write_line
  then
;

# Test send-safe with valid channel
: test-send-safe-success ( -- )
  make-channel  # create channel, get ID
  42 swap send-safe
  "send-safe returns 1 on success" print-result
;

# Test send-safe with invalid channel ID
: test-send-safe-invalid ( -- )
  42 999999 send-safe  # non-existent channel
  not "send-safe returns 0 for invalid channel" print-result
;

# Test receive-safe with valid channel
: test-receive-safe-success ( -- )
  make-channel  # create channel, get ID
  dup 42 swap send  # send value
  receive-safe  # returns (value success_flag)
  "receive-safe returns 1 on success" print-result
  42 = "receive-safe gets correct value" print-result
;

# Test receive-safe with invalid channel ID
: test-receive-safe-invalid ( -- )
  999999 receive-safe  # non-existent channel
  not "receive-safe returns 0 for invalid channel" print-result
  drop  # drop the placeholder value
;

: main ( -- )
  "Testing send-safe:" write_line
  test-send-safe-success
  test-send-safe-invalid

  "Testing receive-safe:" write_line
  test-receive-safe-success
  test-receive-safe-invalid
;
