# Integration test for std:fmath
#
# This test uses `include std:fmath` to verify the module works.

include std:fmath

# Helper to check if two floats are approximately equal
# (within 0.0001 tolerance for floating point comparison)
: f.approx-eq ( Float Float -- Int )
  f.subtract f.abs 0.0001 f.<
;

: assert-float-eq ( Float Float String -- )
  rot rot f.approx-eq if
    " PASS" string.concat io.write-line
  else
    " FAIL" string.concat io.write-line
  then
;

: test-f-abs ( -- )
  "Testing f.abs:" io.write-line
  5.0 f.abs 5.0 "  f.abs(5.0) = 5.0" assert-float-eq
  -5.0 f.abs 5.0 "  f.abs(-5.0) = 5.0" assert-float-eq
  0.0 f.abs 0.0 "  f.abs(0.0) = 0.0" assert-float-eq
  -3.14159 f.abs 3.14159 "  f.abs(-3.14159) = 3.14159" assert-float-eq
;

: test-f-max ( -- )
  "Testing f.max:" io.write-line
  3.0 7.0 f.max 7.0 "  f.max(3.0, 7.0) = 7.0" assert-float-eq
  7.0 3.0 f.max 7.0 "  f.max(7.0, 3.0) = 7.0" assert-float-eq
  5.5 5.5 f.max 5.5 "  f.max(5.5, 5.5) = 5.5" assert-float-eq
  -10.0 -5.0 f.max -5.0 "  f.max(-10.0, -5.0) = -5.0" assert-float-eq
;

: test-f-min ( -- )
  "Testing f.min:" io.write-line
  3.0 7.0 f.min 3.0 "  f.min(3.0, 7.0) = 3.0" assert-float-eq
  7.0 3.0 f.min 3.0 "  f.min(7.0, 3.0) = 3.0" assert-float-eq
  5.5 5.5 f.min 5.5 "  f.min(5.5, 5.5) = 5.5" assert-float-eq
  -10.0 -5.0 f.min -10.0 "  f.min(-10.0, -5.0) = -10.0" assert-float-eq
;

: test-f-sign ( -- )
  "Testing f.sign:" io.write-line
  5.0 f.sign 1.0 "  f.sign(5.0) = 1.0" assert-float-eq
  -5.0 f.sign -1.0 "  f.sign(-5.0) = -1.0" assert-float-eq
  0.0 f.sign 0.0 "  f.sign(0.0) = 0.0" assert-float-eq
  100.5 f.sign 1.0 "  f.sign(100.5) = 1.0" assert-float-eq
  -0.001 f.sign -1.0 "  f.sign(-0.001) = -1.0" assert-float-eq
;

: test-f-square ( -- )
  "Testing f.square:" io.write-line
  5.0 f.square 25.0 "  f.square(5.0) = 25.0" assert-float-eq
  -3.0 f.square 9.0 "  f.square(-3.0) = 9.0" assert-float-eq
  0.0 f.square 0.0 "  f.square(0.0) = 0.0" assert-float-eq
  1.5 f.square 2.25 "  f.square(1.5) = 2.25" assert-float-eq
;

: test-f-neg ( -- )
  "Testing f.neg:" io.write-line
  5.0 f.neg -5.0 "  f.neg(5.0) = -5.0" assert-float-eq
  -3.14 f.neg 3.14 "  f.neg(-3.14) = 3.14" assert-float-eq
  0.0 f.neg 0.0 "  f.neg(0.0) = 0.0" assert-float-eq
;

: test-f-clamp ( -- )
  "Testing f.clamp:" io.write-line
  50.0 0.0 100.0 f.clamp 50.0 "  f.clamp(50.0, 0.0, 100.0) = 50.0" assert-float-eq
  -10.0 0.0 100.0 f.clamp 0.0 "  f.clamp(-10.0, 0.0, 100.0) = 0.0" assert-float-eq
  150.0 0.0 100.0 f.clamp 100.0 "  f.clamp(150.0, 0.0, 100.0) = 100.0" assert-float-eq
  0.5 0.0 1.0 f.clamp 0.5 "  f.clamp(0.5, 0.0, 1.0) = 0.5" assert-float-eq
  -0.5 0.0 1.0 f.clamp 0.0 "  f.clamp(-0.5, 0.0, 1.0) = 0.0" assert-float-eq
  1.5 0.0 1.0 f.clamp 1.0 "  f.clamp(1.5, 0.0, 1.0) = 1.0" assert-float-eq
;

: main ( -- )
  "=== std:fmath Integration Tests ===" io.write-line
  "" io.write-line
  test-f-abs
  test-f-max
  test-f-min
  test-f-sign
  test-f-square
  test-f-neg
  test-f-clamp
  "" io.write-line
  "All tests completed." io.write-line
;
