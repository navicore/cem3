# Test chan.send and chan.receive with Channel type
# Note: All channel operations now return success flags (errors are values, not crashes)
#
# NOTE: Tests for invalid channel IDs have been removed. With the Channel type system,
# passing invalid IDs is now a compile-time type error rather than a runtime error.
# The type system guarantees that only valid Channel handles can be used with chan operations.

# Test chan.send with valid channel
: test-chan.send-success ( -- )
  chan.make  # create channel, get Channel
  42 swap chan.send
  test.assert
;

# Test chan.receive with valid channel
: test-chan.receive-success ( -- )
  chan.make  # create channel, get Channel
  dup 42 swap chan.send  # send value, returns success flag
  test.assert  # send should succeed
  chan.receive  # returns (value success_flag)
  test.assert  # success flag should be true
  42 test.assert-eq  # value should be 42
;

# NOTE: Tests for closed channel operations have been removed.
# The current channel semantics use reference counting - channels close
# when ALL references are dropped. You cannot receive from a "closed" channel because
# if you have a reference to receive from, the channel isn't closed yet.
